<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="0">

        <record id="view_order_form_reserve" model="ir.ui.view">
            <field name="name">sale.order.form.reserve</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_stock.view_order_form_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="/form/header/button[@name='action_button_confirm'][@states='draft']" position="replace">
                    <button name="action_button_confirm" states="reserve" class="oe_highlight" string="Confirm Sale" type="object" groups="base.group_user"/>
                </xpath>
                <xpath expr="/form/header/button[@name='action_button_confirm'][@states='sent']" position="replace"/>


                <button name="action_quotation_send" position="before">

                    <button name="%(action_sale_stock_reserve)d"
                        type="action"
                        string="Reserve Stock"
                        help="Pre-book products from stock"

                        />
                </button>

                <button name="action_quotation_send" position="after">
                    <button name="order_reserve"
                        string="Reserve Stock"
                        states="draft,sent"
                        />
                </button>

                <field name="order_line" position="attributes">
                    <attribute name="options">{"reload_on_button": 1}</attribute>
                </field>

                <xpath expr="//field[@name='order_line']/form//field[@name='state']" position="before">
                    <field name="reservation_ids" invisible="1"/>
                    <button name="stock_reserve"
                        type="object"
                        string="Reserve Stock"
                        attrs="{'invisible': ['|', ('reservation_ids', '!=', []),
                                                   ('state', '!=', 'draft')]}" />
                    <button name="release_stock_reservation"
                        type="object"
                        string="Release Reservation"
                        attrs="{'invisible': ['|', ('reservation_ids', '=', []),
                                                   ('state', '!=', 'draft')]}" />
                </xpath>

                <xpath expr="//field[@name='order_line']/tree/field[@name='price_subtotal']" position="after">
                    <field name="reservation_ids" invisible="1"/>

                    <button name="stock_reserve"
                        type="object"
                        string="Reserve Stock"
                        icon="terp-locked"
                        />

                    <button name="release_stock_reservation"
                        type="object"
                        string="Release Reservation"
                        icon="gtk-undo"
                        attrs="{'invisible': [('reservation_ids', '=', [])]}" />
                </xpath>


            </field>
        </record>




        <!-- search by Salesteams -->
        <record id="action_orders_reserve" model="ir.actions.act_window">
            <field name="name">Sales Reserved</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="domain">[('state','in',('reserve',))]</field>
            <field name="context">{
                    'search_default_my_sale_orders_filter': 1,
                    'default_state': 'reserve',
                }
            </field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a sale with reserved goods that can be converted into a sales
                order.
              </p><p>
                OpenERP will help you efficiently handle the complete sales flow:
                quotation, sales order, delivery, invoicing and payment.
              </p>
            </field>
        </record>

         <menuitem action="action_orders_reserve" id="menu_sale_order_reserve" parent="base.menu_sales" sequence="5" groups="base.group_sale_salesman,base.group_sale_manager"/>
    </data>
</openerp>
